# Feature Sliced Design (FSD)

## Оглавление

- [Что такое FSD](ARCHITECTURE.md#что-такое-FSD)
- [Немного о мотивации FSD](ARCHITECTURE.md#немного-о-мотивации-fsd)
- [Что из себя представляет FSD](ARCHITECTURE.md#что-из-себя-представляет-fsd)
  - [Слой](ARCHITECTURE.md#слой)
  - [Слайс](ARCHITECTURE.md#слайс)
  - [Сегмент](ARCHITECTURE.md#сегмент)
- [Преимущества](ARCHITECTURE.md#преимущества)
- [Как определить, к какому слою относится слайс](ARCHITECTURE.md#как-определить-к-какому-слою-относится-слайс)
- [ВАЖНО](ARCHITECTURE.md#важно)
- [Структура проекта](ARCHITECTURE.md#структура-проекта)
- [Подробнее про FSD](ARCHITECTURE.md#подробнее-про-fsd)

## Что такое FSD

**FSD** - это архитектурная методология построения интерфейсных приложений, которая представляет собой сборник правил и соглшений по организации кода.

**Цель данной методологии** - сделать проект более понятным и структурированным перед лицом постоянно меняющихся требований бизнеса.

## Немного о мотивации FSD

Основная идея заключается в облегчении и удешевлении разработки сложных проектов. Конечно, уже существуют устоявшиеся подходы и принципы проектирования, такие как *SOLID*, *KISS*, *YAGNI*, *DRY* и т.д., но одних только принципов для создания хорошей архиеткутры недостаточно. Также этм принципы слишком общие и не дают ответа на вопрос о том, как спроектировать структуру и архитектуру масштабируемого и гибкого приложения.

## Что из себя представляет FSD

Разберем понятия, которые существуют в FSD.

### Слой

Слои представляют собой бизнес ориентированные части приложения со своей зоной ответственности, которые позволяют разделить проект на ступенчатую иерархию, т.е. нижележащие слои не могут содержать в себе вышележащие, либо комбинируют их. Количество слоев всего 7, но некоторые из них могут быть опциональными:

- `app` - входная точка в приложение. Здесь хранятся необходимые провайдеры, глобальные стили и лайауты. Иными словами, здесь расположена инициализирующая логика приложения.
- `processes` - юзкейсы, которые протекают через несколько страниц. Например, процесс аутентификации и авторизации пользователя.
- `pages` - содержит в себе комбинации *widgets* и *features*. Страница должна оставаться максимально тонкой без лишней бищнес логики. В идеале, страница - это перечисление widgets и features, обернутых в какой нибудь лайаут.
- `widgets` - самостоятельные смысловые блоки, которые комбинируют нижележащие слои (*features* и *entities*). Фичи вставляются в сущности при помощи слотов. Например, пост (*entities*) с возможностью оставить комментарий или поставить лайк (*features*).
- `features` - части функциональности, несущие бизнес-ценность (поставить лайк, подписаться, сменить язык). Один модуль фичи должен отвечать за одну функциональность.
- `entities` - бизнес сущности (пост, статья, комментарий, заказ, карточка товара). Это своего рода шаблоны (лайауты) для создания самостоятельных компонентов со своей логикой (лайауты бизнес-сущностей).
- `shared` - содержит в себе максимально переиспользуемые компоненты системы, не содержащие внутри себя никакой бизнес-логики (например, UI-компоненты).

Ниже представлена таблица, которая отражает возможность использования одного слоя внутри себя других слоев.

|    Layer    |                                                                                                          Can use                                                                                                           |                                                                   Can be used by                                                                    |
|:-----------:|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:---------------------------------------------------------------------------------------------------------------------------------------------------:|
|    *app*    |                                                                             `shared`, `entities`, `features`, `widgets`, `pages`, `processes`                                                                              |                                                                          -                                                                          |
| *processes* |                                                                                    `shared`, `entities`, `features`, `widgets`, `pages`                                                                                    |                                                                        `app`                                                                        |
|   *pages*   |                                                                                        `shared`, `entities`, `features`, `widgets`                                                                                         |                                                                 `processes`, `app`                                                                  |
|  *widgets*  |                                                                                              `shared`, `entities`, `features`                                                                                              |                                                             `pages`, `processes`, `app`                                                             |
| *features*  |                                                                                                    `shared`, `entities`                                                                                                    |                                                       `widgets`, `pages`, `processes`, `app`                                                        |
| *entities*  |                                                                                                          `shared`                                                                                                          |                                                 `features`, `widgets`, `pages`, `processes`, `app`                                                  |
|  *shared*   | `shared`<br/>*Существуют кейсы, когда необходимо при создании одного UI компонента использовать другой, но никакой слой под такие кейсы не подходит. Поэтому разрешается взаимодействие компонентов shared друг с другом.* |                                           `entities`, `features`, `widgets`, `pages`, `processes`, `app`                                            |

### Слайс

Каждый слой содержит в себе слайсы. Слайс - это модуль, который отвечает за конкретный компонент и привязанный к нему функционал. Примеры:

- **entities**: *EProduct*, *EOrder*, *EUser*, *EComment*
- **features**: *FAuthByPhone*, *FChangePhoneForm*, *FArticleFeedback*
- **widgets**: *WSidebar*, *WHeader*, *WPostCard*

![img.png](contributing/module.png)

![img.png](contributing/tree.png)

### Сегмент

Каждый слайс содержит в себе сегменты. Сегменты являются отдельными частями, которые предоставляют необходиммые элементы для создания слайса и наделения его нужным функционалом. Это могут функции, типы, компоненты и т.д. Пример сегмента для слайса какого-либо слоя:

- ***UI*** - компоненты пользовательского интерфейса.
- ***utils*** - функции-помощники для работы с данными.
- ***api*** - функции для работы с api.
- ***constants*** - константы, которые используются в слайсе

## Преимущества

- Компоненты архитектуры можно гибко заменять или добавлять под новые условия.
- Контролируемые и явные связи между модулями без неожиданных сайд-эффектов.
- Не зависит от технического стека.
- Масштабируемость архитектуры и команды разработки.
- Каждый модуль может быть независимо модифицирован без побочных эффектов.

## Как определить, к какому слою относится слайс

Перед началом разработки модуля необходимо определить, к какому слою он относится. Ниже представлен список вопросов, которые помогут определить принадлежность модуля к какому-либо слою.

- `app` - Это общая инициализирующая логика приложения?
- `processes` - Это относится к конкретному юзкейсу, протекающему через несколько страниц?
- `pages` - Это относится к конкретной странице/экрану?
- `widgets` - Это самостоятельный и полноценный блок страницы с конкретными действиями?
- `features` - Это относится к действию пользователя, представляющему бизнес-ценность?
- `entities` - Это относится непосредственно к бизнес-сущности?
- `shared` - Это не относится к бизнес логике и является общим переиспользуемым компонентом?

## ВАЖНО

1. Слои предназначены для группировки нижележащих слоев.
2. К слоям следует относиться как к зонам ответственности.
3. Слои позволяют сделать поток данных однонаправленным и избежать неявных связей между модулями.
4. Каждый модуль должен предоставлять публичное API (при помощи **export** в **index.ts** файле), передавая вышележащим модулям в вышележащих слоях только необходимые компоненты.
5. При построении FSD архитектуры необходимо сразу думать о проектировании и декомпозировании модуля перед его созданием.
6. Если при определении принадлежности модуля какому-либо слою, лежащему ниже слоя *widgets*, возникает неопределенность, то такой компонент лучше определить как внутренний компонент виджета (если этот компонент не используется в других модулях).

## Структура проекта

- Для именования модулей и компонентов использовать 2 и более слов (включая префикс). Префикс должен быть первой буквой имени слоя, в котором находится модуль. Пример: `e-user-card` (*entity*).
- Директории именуются в стиле `cebab-case`.
- Каждый модуль должен содержать сегменты, которые относятся только к этому модулю. Наличие каждого сегмента опционально в зависимости от требований. Ограничений по количеству сегментов нет. Пример содержания модуля:

  ```
  > api - Функции для работы с API
      user.ts
  > ui - React компоненты, которые относятся непосредственно к модулю
      user-card-header.tsx 
  > constants - Константы
      user.ts
  > lib - функции-помощники для работы с данными
      hooks
        useUserCard.ts
  > types - Типы
      user.ts
    ui.tsx - Ключевой компонент, который будет всегда экспортирован
    index.ts - Публичное API модуля
  ```

- Каждый модуль должен содержать файл **index.ts**, который отвечает за экспорт необходимых компонентов и других его состовляющих из модуля. Пример:

  ```javascript
  // entities/e-user-card/index.ts
  
  export { default as EUserCard } from 'entities/e-user-card/ui'
  ```

  ```tsx
  // widgets/w-user-card/ui.tsx
  import { EProfileCard } from 'entities/profile/e-profile-card'

  export const WUserCard = () => {
    return (
      <EProfileCard
        slots={{
          addToFriends: <FAddToFriends />,
        }}
      />
    )
  }
  ```

### Пример структуры

```bash
> app
  > layouts - Шаблоны для вставки страниц
      /base
        ui.tsx
        index.ts
  > providers - Провайдеры
  > router - Конфигурация router'а
      index.ts
  > styles - Глобальные стили, переменные, миксины и т.д.
      > resources
      > vendor
        index.scss
> pages
  > profile-page - Страница профиля
    > api
    > ui
    > constants
    > lib 
    > types 
      ui.tsx
      index.ts
> widgets
  > w-user-card - Карточка пользователя, самостоятельный компонент приложения
    > api
    > components
    > constants
    > lib
    > types 
      ui.tsx
      index.ts
> features
  > f-change-profile-avatar - Модуль, отвечающий за смену картинки профиля
    > api
    > components
    > constants
    > lib
    > types 
      ui.tsx
      index.ts
> entities
  > e-user-card - Шаблон карточки пользователя
    > api
    > components
    > constants
    > lib
    > types 
      ui.tsx
      index.ts
> shared
  > api
      auth.ts
      index.ts
  > ui
    > s-button
        SButton.tsx
        style.module.scss
    > s-upload
        SUpload.tsx
      index.ts
  > types
      users.ts
      index.ts
  > lib
    > hooks
        useAuth.ts
        index.ts
```

## Подробнее про FSD

- [Руководство](https://feature-sliced.design/docs/get-started/tutorial)
- [О целях и мотивации FSD](https://feature-sliced.design/docs/about)
- [Гайды](https://feature-sliced.design/docs/guides)
- Разбор некоторых кейсов:
  - [Авторизация](https://feature-sliced.design/docs/guides/examples/auth)
  - [Page layout](https://feature-sliced.design/docs/guides/examples/page-layout)
- Примеры:
  - [Vue](https://github.com/EliseyMartynov/fs-vue/tree/master/src)
  - [React](https://github.com/EliseyMartynov/fs-rtk)

Также можно посмотреть видеоролик на YouTube. Таймкод 27:00.

[Смотреть](https://www.youtube.com/watch?v=c3JGBdxfYcU)
